---
- name: Add Nginx PPA from rtcamp with pagespeed
  apt_repository: repo="ppa:rtcamp/nginx" update_cache=yes

- name: Install Nginx
  apt: name=nginx-custom state=present force=yes

- name: Install nginx.conf
  template: src=nginx.conf.j2 dest=/etc/nginx/nginx.conf


- name: Install all default nginx files
  copy: src={{ item }} dest={{consul_template_home}}/templates/{{ item | basename }}
  with_fileglob:
  - ../files/*.conf

- name: Install all default nginx sites
  copy: src={{ item }} dest={{consul_template_home}}/templates/{{ item | basename }}
  with_fileglob:
  - ../files/sites-available/*

- name: Enable all default nginx sites
  file: src=/etc/nginx/sites-available/{{ item | basename }} dest=/etc/nginx/sites-enabled/{{ item | basename }} owner={{ web_user }} group={{ web_user }} state=link
  with_fileglob:
  - ../files/sites-available/*

- name: Create cache folder
  file: path=/var/cache/nginx/ngx_pagespeed_cache state=directory owner={{ web_user }} group={{ web_user }}